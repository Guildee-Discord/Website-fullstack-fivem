<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <!-- Tailwind via cdnjs (v2.2.19) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/base.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/components.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/utilities.min.css" />
  </head>
  <body class="bg-gray-100 min-h-screen">
    <main class="max-w-3xl mx-auto p-6">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold">Dashboard</h1>
        <a href="/logout" class="text-sm text-red-600 hover:underline">D√©connexion</a>
      </div>

      <div class="bg-white rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold">Ton profil</h2>
        <div id="state" class="mt-3 text-gray-700">Chargement‚Ä¶</div>
      </div>

      <div class="mt-4 text-sm text-gray-500">
        <a href="/" class="hover:underline">‚Üê retour</a>
      </div>
    </main>

    <script>
      async function main() {
        const el = document.getElementById("state");
        try {
          const r = await fetch("/api/me");
          if (!r.ok) {
            el.textContent = "Non connect√© (√ßa ne devrait pas arriver ici üòÖ).";
            return;
          }
          const data = await r.json();
          const u = data.user;
          el.innerHTML = `
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center">
                ${u.avatar ? `<img class="w-full h-full object-cover" src="https://cdn.discordapp.com/avatars/${u.discord_id}/${u.avatar}.png" />` : `<span class="text-gray-500">?</span>`}
              </div>
              <div>
                <div class="font-semibold">${u.username}</div>
                <div class="text-xs text-gray-500">discord_id: ${u.discord_id}</div>
              </div>
            </div>
          `;
        } catch (e) {
          el.textContent = "Erreur: " + e.message;
        }
      }
      main();
    </script>
  </body>
</html>

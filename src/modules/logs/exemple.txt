â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¡  GUIDE â€” WEBHOOKS DISCORD MODULES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Objectif :
â†’ GÃ©rer plusieurs webhooks Discord (logs, login, admin, etc.)
â†’ Les initialiser dans un seul module
â†’ Les utiliser proprement depuis tous les autres modules

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš™ï¸  1) Configuration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Fichier : configuration/webhook.json

{
  "webhooks": {
    "url": {
      "logs":  "https://discord.com/api/webhooks/ID/TOKEN",
      "login": "https://discord.com/api/webhooks/ID/TOKEN",
      "admin": "https://discord.com/api/webhooks/ID/TOKEN"
    },
    "custom": {
      "logs": {
        "username": "Website Logs",
        "avatar_url": "https://i.imgur.com/1J5qX5E.png"
      },
      "login": {
        "username": "Login",
        "avatar_url": "https://i.imgur.com/abcd1234.png"
      },
      "admin": {
        "username": "Admin",
        "avatar_url": "https://i.imgur.com/efgh5678.png"
      }
    }
  }
}

ğŸ” ClÃ©s :
- webhooks.url.<nom>       â†’ URL du webhook
- webhooks.custom.<nom>.username
- webhooks.custom.<nom>.avatar_url

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§   2) Container â€“ Signal de disponibilitÃ©
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Dans createContainer(config) :

- ctx.webhooks = null
- ctx.webhooksReady = Promise
- ctx._resolveWebhooksReady = resolve

ğŸ¯ But :
â†’ Tous les modules peuvent faire :

    await ctx.webhooksReady;

â†’ Plus jamais de :
  "Cannot read properties of null"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§©  3) Module logs â€“ Initialisation globale
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Le module logs :
âœ” lit configuration/webhook.json  
âœ” crÃ©e un client par nom (logs, login, adminâ€¦)  
âœ” expose tout dans ctx.webhooks

RÃ©sultat attendu :

ctx.webhooks = {
  logs:  { send, log },
  login: { send, log },
  admin: { send, log }
}

IMPORTANT :
- ctx._resolveWebhooksReady(true)  â†’ quand prÃªt
- ctx._resolveWebhooksReady(false) â†’ si aucun webhook

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€  4) Utilisation dans les autres modules
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Toujours commencer par :

    await ctx.webhooksReady;

VÃ©rifier :

    if (!ctx.webhooks?.login?.send) {
      ctx.logger?.warn?.("[login] webhook non prÃªt");
      return;
    }

Envoyer un message simple :

    try {
      await ctx.webhooks.login.send({
        content: "âœ… Module Login dÃ©marrÃ©"
      });
    } catch (e) {
      ctx.logger?.warn?.("[login] webhook error: " + (e.message || String(e)));
    }

Envoyer un log embed :

    try {
      await ctx.webhooks.login.log({
        level: "success",
        title: "Module Login",
        message: "DÃ©marrÃ© correctement",
        fields: [
          { name: "Serveur", value: "prod-1", inline: true },
          { name: "Port", value: "3000", inline: true }
        ]
      });
    } catch (e) {
      ctx.logger?.warn?.("[login] webhook log error: " + (e.message || String(e)));
    }

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ—‚ï¸  5) Ajouter un nouveau webhook
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Ajouter dans configuration/webhook.json :

    webhooks.url.staff
    webhooks.custom.staff

2. Utiliser :

    ctx.webhooks.staff.send(...)
    ctx.webhooks.staff.log(...)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸  6) ProblÃ¨mes courants
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ Cannot read properties of null  
â†’ Tu as oubliÃ© : await ctx.webhooksReady;

âŒ UnhandledPromiseRejection  
â†’ Tu nâ€™as pas mis try/catch autour de send/log

âŒ Rien ne sâ€™envoie  
â†’ URL invalide / webhook supprimÃ© / token faux

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ  7) Exemple minimal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

await ctx.webhooksReady;

try {
  await ctx.webhooks?.logs?.send?.({ content: "Hello webhook ğŸ‘‹" });
} catch (e) {
  ctx.logger?.warn?.("Webhook error: " + (e.message || String(e)));
}